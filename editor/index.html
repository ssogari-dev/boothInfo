<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ìŠ¤ ì •ë³´ ì—ë””í„°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            position: relative;
        }

        .header h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .header-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-info {
            background: #38b2ac;
            color: white;
        }

        .btn-secondary {
            background: #718096;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .editor-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 1.3rem;
            color: #4a5568;
            margin-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        .booth-list {
            display: grid;
            gap: 15px;
        }

        .booth-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .booth-item h4 {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .remove-booth-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f56565;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-booth-btn:hover {
            background: #e53e3e;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .image-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .image-item {
            background: #e2e8f0;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            position: relative;
            padding-right: 25px;
        }

        .remove-image-btn {
            position: absolute;
            top: 2px;
            right: 5px;
            background: none;
            border: none;
            color: #f56565;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .genre-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .genre-item {
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            position: relative;
            padding-right: 20px;
        }

        .remove-genre-btn {
            position: absolute;
            top: 1px;
            right: 3px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.7rem;
        }

        .add-btn {
            background: #48bb78;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .add-btn:hover {
            background: #38a169;
        }

        .json-preview {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .file-input {
            margin-bottom: 15px;
        }

        .hidden {
            display: none;
        }

        .autocomplete-container {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s ease;
        }

        .suggestion-item:hover,
        .suggestion-item.highlighted {
            background-color: #f0f8ff;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-category {
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
        }

        .genre-input-container {
            position: relative;
        }

        .sort-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .sort-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .sort-btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .sort-info {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        /* í”Œë¡œíŒ… ë²„íŠ¼ë“¤ */
        .floating-buttons {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .floating-add-btn, .floating-save-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-add-btn {
            background: #48bb78;
            color: white;
        }

        .floating-save-btn {
            background: #4299e1;
            color: white;
            font-size: 1.2rem;
        }

        .floating-save-btn.has-changes {
            background: #ed8936;
            animation: pulse 2s infinite;
        }

        .floating-add-btn:hover, .floating-save-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .floating-add-btn:active, .floating-save-btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        /* í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0% {
                box-shadow: 0 4px 20px rgba(237, 137, 54, 0.4);
            }
            50% {
                box-shadow: 0 4px 20px rgba(237, 137, 54, 0.8);
            }
            100% {
                box-shadow: 0 4px 20px rgba(237, 137, 54, 0.4);
            }
        }

        /* ì €ì¥ ìƒíƒœ í‘œì‹œ */
        .save-status {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .save-status.saved {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .save-status.unsaved {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        /* ì €ì¥ ì•Œë¦¼ */
        .save-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .save-notification.show {
            transform: translateX(0);
        }

        /* ê¸°ì¡´ í—¤ë”ì˜ ìƒˆ ë¶€ìŠ¤ ì¶”ê°€ ë²„íŠ¼ê³¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ìŠ¤íƒ€ì¼ ì¡°ì • */
        .header-controls .btn-warning {
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ë¶€ìŠ¤ ì •ë³´ ì—ë””í„°</h1>
        <div id="saveStatus" class="save-status saved">ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë¨</div>
        <div class="header-controls">
            <input type="file" id="fileInput" accept=".json" class="hidden">
            <button class="btn btn-primary" onclick="loadFile()">JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="btn btn-success" onclick="downloadJSON()">JSON íŒŒì¼ ë‚´ë³´ë‚´ê¸°</button>
            <button class="btn btn-warning" onclick="addBooth()">ìƒˆ ë¶€ìŠ¤ ì¶”ê°€</button>
            <button class="btn btn-info" onclick="loadFromLocalStorage()">ì„ì‹œ ì €ì¥ ë³µì›</button>
            <button class="btn btn-secondary" onclick="clearAutoSave()">ì„ì‹œ ì €ì¥ ì‚­ì œ</button>
            <a href="index.html" class="btn btn-danger">ë©”ì¸ ì‚¬ì´íŠ¸ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>

    <div class="container">
        <!-- í–‰ì‚¬ ì •ë³´ ì„¹ì…˜ -->
        <div class="editor-section">
            <h2 class="section-title">í–‰ì‚¬ ì •ë³´</h2>
            <div class="form-group">
                <label for="eventName">í–‰ì‚¬ëª…</label>
                <input type="text" id="eventName" class="form-control" placeholder="ì˜ˆ: ì½”ë¯¹ì›”ë“œ 2025 ì—¬ë¦„">
            </div>
        </div>

        <!-- ë¶€ìŠ¤ ëª©ë¡ ì„¹ì…˜ -->
        <div class="editor-section">
            <h2 class="section-title">ë¶€ìŠ¤ ëª©ë¡</h2>
            <div class="sort-controls">
                <button class="sort-btn" onclick="sortBooths()">ë¶€ìŠ¤ ë²ˆí˜¸ ìˆœìœ¼ë¡œ ì •ë ¬</button>
                <button class="sort-btn" onclick="convertBoothNumbersToUpperCase()">ë¶€ìŠ¤ ë²ˆí˜¸ ëŒ€ë¬¸ì ë³€í™˜</button>
                <span class="sort-info">ì •ë ¬ ìˆœì„œ: A~Z â†’ AA~ZZ â†’ ì•ŒíŒŒë²³-ë²ˆí˜¸ ìˆœ</span>
            </div>
            <div id="boothList" class="booth-list">
                <!-- ë¶€ìŠ¤ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- JSON ë¯¸ë¦¬ë³´ê¸° ì„¹ì…˜ -->
        <div class="editor-section">
            <h2 class="section-title">JSON ë¯¸ë¦¬ë³´ê¸°</h2>
            <div id="jsonPreview" class="json-preview"></div>
        </div>
    </div>

    <div class="floating-buttons">
        <button class="floating-add-btn" onclick="addBoothAndScroll()" title="ìƒˆ ë¶€ìŠ¤ ì¶”ê°€">
            +
        </button>
        <button class="floating-save-btn" onclick="manualSave()" title="ìˆ˜ë™ ì €ì¥">
            ğŸ’¾
        </button>
    </div>

    <script>
        let eventData = {
            eventName: "",
            booths: []
        };

        // ë³€ê²½ì‚¬í•­ ì¶”ì  ë³€ìˆ˜
        let hasUnsavedChanges = false;
        let lastSavedData = '';

        // ë¯¸ë¦¬ ì •ì˜ëœ ì¥ë¥´ ëª©ë¡
        const predefinedGenres = [
            'í˜¸ìš”ë²„ìŠ¤', 'ë¶•ê´´: ìŠ¤íƒ€ë ˆì¼', 'ì›ì‹ ', 'ì  ë ˆìŠ¤ ì¡´ ì œë¡œ', 'ë¶•ê´´3rd',
            'ëª…ì¼ë°©ì£¼', 'ëª…ì¡°: ì›Œë”ë§ ì›¨ì´ë¸Œ', 'íŠ¸ë¦­ì»¬ RE:VIVE', 'ìŒì„±í•©ì„±ì—”ì§„ (í•œêµ­)', 'ìŒì„±í•©ì„±ì—”ì§„ (ì¼ë³¸)',
            'í”„ë¡œì íŠ¸ ì„¸ì¹´ì´', 'ì˜¤ë¦¬ì§€ë„ ìºë¦­í„°', 'ì•™ìƒë¸” ìŠ¤íƒ€ì¦ˆ', 'ëŸ¬ë¸Œ ë¼ì´ë¸Œ', 'ì•„ì´ëŒ ë§ˆìŠ¤í„°', 'ë¸”ë£¨ ì•„ì¹´ì´ë¸Œ',
            'ìŠ¹ë¦¬ì˜ ì—¬ì‹ : ë‹ˆì¼€', 'í™€ë¡œë¼ì´ë¸Œ', 'ë‹ˆì§€ì‚°ì§€', 'ë²„ì¸„ì–¼', 'ìŠ¤í…”ë¼ì´ë¸Œ', 'ì´í„°ë„ ë¦¬í„´', 'ë±…ë“œë¦¼', 'ë™ë°© í”„ë¡œì íŠ¸',
            'GL (ë°±í•©)', 'ê¸°ì—…ë¶€ìŠ¤', 'ì•„ì¹´ë°ë¯¸ì¡´', 'íŒ¬ì‚¬ì¸ì¡´', 'ë´‡ì¹˜ ë” ë¡', 'ê±¸ì¦ˆ ë°´ë“œ í¬ë¼ì´', 'ìŠ¤íŒŒì´ íŒ¨ë°€ë¦¬', 'ì¥ì†¡ì˜ í”„ë¦¬ë Œ',
            'ë¦¼ë²„ìŠ¤ ì»´í¼ë‹ˆ', 'AI ì‚¬ìš©', 'ë¸Œë¼ìš´ ë”ìŠ¤íŠ¸', 'BL', 
        ];

        // í˜„ì¬ í™œì„±í™”ëœ ìë™ì™„ì„±
        let currentAutocomplete = null;
        let selectedSuggestionIndex = -1;
        
        // ë¶€ìŠ¤ ë²ˆí˜¸ ì •ë ¬ í•¨ìˆ˜
        function parseBoothNumber(boothNumber) {
            // ë¶€ìŠ¤ ë²ˆí˜¸ë¥¼ ì•ŒíŒŒë²³ ë¶€ë¶„ê³¼ ìˆ«ì ë¶€ë¶„ìœ¼ë¡œ ë¶„ë¦¬
            const match = boothNumber.match(/^([A-Z]+)-?(\d+)?$/);
            if (match) {
                const letters = match[1];
                const number = match[2] ? parseInt(match[2]) : 0;
                return { letters, number };
            }
            return { letters: boothNumber, number: 0 };
        }

        function sortBooths() {
            if (eventData.booths.length === 0) {
                alert('ì •ë ¬í•  ë¶€ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë¶€ìŠ¤ ë²ˆí˜¸ ì •ë ¬
            eventData.booths.sort((a, b) => {
                const parsedA = parseBoothNumber(a.boothNumber || '');
                const parsedB = parseBoothNumber(b.boothNumber || '');

                // 1. ì•ŒíŒŒë²³ ë¶€ë¶„ì˜ ê¸¸ì´ë¡œ ë¨¼ì € ì •ë ¬ (A, B, C... ë‹¤ìŒì— AA, AB, AC...)
                if (parsedA.letters.length !== parsedB.letters.length) {
                    return parsedA.letters.length - parsedB.letters.length;
                }

                // 2. ê°™ì€ ê¸¸ì´ë©´ ì•ŒíŒŒë²³ ìˆœìœ¼ë¡œ ì •ë ¬
                if (parsedA.letters !== parsedB.letters) {
                    return parsedA.letters.localeCompare(parsedB.letters);
                }

                // 3. ì•ŒíŒŒë²³ì´ ê°™ìœ¼ë©´ ìˆ«ì ìˆœìœ¼ë¡œ ì •ë ¬
                return parsedA.number - parsedB.number;
            });

            // UI ë‹¤ì‹œ ë¡œë“œ
            loadEventData();
            
            // ì •ë ¬ ì™„ë£Œ ë©”ì‹œì§€
            const sortedNumbers = eventData.booths.map(booth => booth.boothNumber).filter(Boolean);
            if (sortedNumbers.length > 0) {
                alert(`ë¶€ìŠ¤ê°€ ì •ë ¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nìˆœì„œ: ${sortedNumbers.slice(0, 10).join(', ')}${sortedNumbers.length > 10 ? '...' : ''}`);
            }
        }

        // ë¶€ìŠ¤ ë²ˆí˜¸ ëŒ€ë¬¸ì ë³€í™˜ í•¨ìˆ˜
        function convertBoothNumbersToUpperCase() {
            if (eventData.booths.length === 0) {
                alert('ë³€í™˜í•  ë¶€ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë³€í™˜ ì „ í™•ì¸
            if (!confirm('ëª¨ë“  ë¶€ìŠ¤ ë²ˆí˜¸ë¥¼ ëŒ€ë¬¸ìë¡œ ë³€í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            let convertedCount = 0;
            let changedBooths = [];

            // ëª¨ë“  ë¶€ìŠ¤ì˜ ë¶€ìŠ¤ ë²ˆí˜¸ë¥¼ ëŒ€ë¬¸ìë¡œ ë³€í™˜
            eventData.booths.forEach((booth, index) => {
                if (booth.boothNumber) {
                    const originalNumber = booth.boothNumber;
                    const upperCaseNumber = originalNumber.toUpperCase();
                    
                    if (originalNumber !== upperCaseNumber) {
                        booth.boothNumber = upperCaseNumber;
                        changedBooths.push(`${originalNumber} â†’ ${upperCaseNumber}`);
                        convertedCount++;
                    }
                }
            });

            // UI ì—…ë°ì´íŠ¸
            if (convertedCount > 0) {
                loadEventData(); // ì „ì²´ UI ë‹¤ì‹œ ë¡œë“œ
                
                // ë³€í™˜ ê²°ê³¼ ì•Œë¦¼
                const message = `${convertedCount}ê°œì˜ ë¶€ìŠ¤ ë²ˆí˜¸ê°€ ëŒ€ë¬¸ìë¡œ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.`;
                alert(message);
                
                // ìë™ ì €ì¥
                saveToLocalStorage();
                checkForChanges();
            } else {
                alert('ë³€í™˜í•  ë¶€ìŠ¤ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ë³€ê²½ì‚¬í•­ ê°ì§€ í•¨ìˆ˜
        function checkForChanges() {
            const currentData = JSON.stringify(eventData);
            hasUnsavedChanges = (currentData !== lastSavedData);
            
            // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateSaveStatus();
        }

        // ì €ì¥ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSaveStatus() {
            const statusElement = document.getElementById('saveStatus');
            if (statusElement) {
                if (hasUnsavedChanges) {
                    statusElement.textContent = 'ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤';
                    statusElement.className = 'save-status unsaved';
                } else {
                    statusElement.textContent = 'ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë¨';
                    statusElement.className = 'save-status saved';
                }
            }
            updateManualSaveButton();
        }

        // ìë™ ì €ì¥ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function saveToLocalStorage() {
            try {
                const timestamp = new Date().toISOString();
                const backupData = {
                    ...eventData,
                    lastSaved: timestamp
                };
                localStorage.setItem('eventDataBackup', JSON.stringify(backupData));
                console.log('ìë™ ì €ì¥ ì™„ë£Œ:', new Date(timestamp).toLocaleString());
            } catch (e) {
                console.error('ìë™ ì €ì¥ ì‹¤íŒ¨:', e);
                alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì •ë¦¬í•´ì£¼ì„¸ìš”.');
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('eventDataBackup');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData && parsedData.booths && parsedData.lastSaved) {
                        const lastSavedTime = new Date(parsedData.lastSaved).toLocaleString();
                        
                        if (confirm(`ì„ì‹œ ì €ì¥ëœ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤.\në§ˆì§€ë§‰ ì €ì¥: ${lastSavedTime}\n\në³µì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                            // íƒ€ì„ìŠ¤íƒ¬í”„ ì œê±° í›„ ë°ì´í„° ë³µì›
                            const { lastSaved, ...cleanData } = parsedData;
                            eventData = cleanData;
                            loadEventData();
                            lastSavedData = JSON.stringify(eventData);
                            hasUnsavedChanges = false;
                            alert('ì„ì‹œ ì €ì¥ ë°ì´í„°ê°€ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        } else {
                            // ë³µì›í•˜ì§€ ì•Šì„ ê²½ìš° í˜„ì¬ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
                            lastSavedData = JSON.stringify(eventData);
                            hasUnsavedChanges = false;
                        }
                    }
                }
            } catch (e) {
                console.error('ì„ì‹œ ì €ì¥ ë°ì´í„° ë³µêµ¬ ì‹¤íŒ¨:', e);
            }
        }

        // ìˆ˜ë™ ì €ì¥ í•¨ìˆ˜
        function manualSave() {
            saveToLocalStorage();
            lastSavedData = JSON.stringify(eventData);
            hasUnsavedChanges = false;
            
            // ì„±ê³µ ì•Œë¦¼
            showSaveNotification('ìˆ˜ë™ ì €ì¥ ì™„ë£Œ!');
        }

        // ì €ì¥ ì•Œë¦¼ í‘œì‹œ
        function showSaveNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'save-notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 2000);
        }

        // ì£¼ê¸°ì  ìë™ ì €ì¥ (30ì´ˆë§ˆë‹¤)
        setInterval(() => {
            if (hasUnsavedChanges) {
                saveToLocalStorage();
            }
        }, 30000);

        // ì„ì‹œ ì €ì¥ ë°ì´í„° ì‚­ì œ í•¨ìˆ˜
        function clearAutoSave() {
            if (confirm('ì„ì‹œ ì €ì¥ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('eventDataBackup');
                showSaveNotification('ì„ì‹œ ì €ì¥ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìˆ˜ë™ ì €ì¥ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateManualSaveButton() {
            const saveBtn = document.querySelector('.floating-save-btn');
            if (saveBtn) {
                if (hasUnsavedChanges) {
                    saveBtn.classList.add('has-changes');
                    saveBtn.title = 'ë³€ê²½ì‚¬í•­ì„ ìˆ˜ë™ ì €ì¥';
                } else {
                    saveBtn.classList.remove('has-changes');
                    saveBtn.title = 'ìˆ˜ë™ ì €ì¥ (ë³€ê²½ì‚¬í•­ ì—†ìŒ)';
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            updatePreview();
            lastSavedData = JSON.stringify(eventData);
            
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„ì‹œ ì €ì¥ ë°ì´í„° í™•ì¸
            loadFromLocalStorage();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.getElementById('eventName').addEventListener('input', function() {
                eventData.eventName = this.value;
                updatePreview();
                saveToLocalStorage(); // ìë™ ì €ì¥
                checkForChanges(); // ë³€ê²½ì‚¬í•­ ì²´í¬
            });

            // ë¬¸ì„œ í´ë¦­ ì‹œ ìë™ì™„ì„± ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.autocomplete-container')) {
                    closeAutocomplete();
                }
            });

            // ì°½ ë‹«ê¸° ì „ í™•ì¸ í”„ë¡¬í”„íŠ¸
            window.addEventListener('beforeunload', function(e) {
                if (hasUnsavedChanges) {
                    const confirmationMessage = 'ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì •ë§ ì°½ì„ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?';
                    e.preventDefault();
                    e.returnValue = confirmationMessage;
                    return confirmationMessage;
                }
            });
        });

        // ëª¨ë“  ì¥ë¥´ ìˆ˜ì§‘ (ê¸°ì¡´ ë°ì´í„° + ë¯¸ë¦¬ ì •ì˜ëœ ì¥ë¥´)
        function getAllGenres() {
            const existingGenres = new Set();
            
            // í˜„ì¬ ë°ì´í„°ì—ì„œ ì¥ë¥´ ìˆ˜ì§‘
            eventData.booths.forEach(booth => {
                if (booth.genres) {
                    booth.genres.forEach(genre => existingGenres.add(genre));
                }
            });

            // ë¯¸ë¦¬ ì •ì˜ëœ ì¥ë¥´ì™€ í•©ì¹˜ê¸°
            const allGenres = [...new Set([...predefinedGenres, ...existingGenres])];
            return allGenres.sort();
        }

        // ìë™ì™„ì„± í‘œì‹œ
        function showAutocomplete(input, suggestions) {
            closeAutocomplete(); // ê¸°ì¡´ ìë™ì™„ì„± ë‹«ê¸°

            if (suggestions.length === 0) return;

            const container = input.parentElement;
            const suggestionDiv = document.createElement('div');
            suggestionDiv.className = 'autocomplete-suggestions';
            
            suggestions.forEach((suggestion, index) => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                
                // ë¯¸ë¦¬ ì •ì˜ëœ ì¥ë¥´ì¸ì§€ í™•ì¸
                const isPredefined = predefinedGenres.includes(suggestion);
                item.innerHTML = `
                    ${suggestion}
                    ${isPredefined ? '<span class="suggestion-category">(ì¶”ì²œ)</span>' : '<span class="suggestion-category">(ê¸°ì¡´ ë°ì´í„°)</span>'}
                `;
                
                item.addEventListener('click', function() {
                    input.value = suggestion;
                    closeAutocomplete();
                    input.focus();
                });
                
                suggestionDiv.appendChild(item);
            });

            container.appendChild(suggestionDiv);
            currentAutocomplete = suggestionDiv;
            selectedSuggestionIndex = -1;
        }

        // ìë™ì™„ì„± ë‹«ê¸°
        function closeAutocomplete() {
            if (currentAutocomplete) {
                currentAutocomplete.remove();
                currentAutocomplete = null;
                selectedSuggestionIndex = -1;
            }
        }

        // ì¥ë¥´ ì…ë ¥ í•„í„°ë§
        function filterGenres(input) {
            const value = input.toLowerCase().trim();
            if (value.length < 1) return [];

            const allGenres = getAllGenres();
            return allGenres.filter(genre => 
                genre.toLowerCase().includes(value)
            ).slice(0, 10); // ìµœëŒ€ 10ê°œë§Œ í‘œì‹œ
        }

        function addBoothAndScroll() {
            const currentLength = eventData.booths.length;
            addBooth();
            
            // ìƒˆë¡œ ì¶”ê°€ëœ ë¶€ìŠ¤ë¡œ ìŠ¤í¬ë¡¤
            setTimeout(() => {
                const newBoothElement = document.querySelectorAll('.booth-item')[currentLength];
                if (newBoothElement) {
                    newBoothElement.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                    
                    // ë¶€ìŠ¤ ë²ˆí˜¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
                    const boothNumberInput = newBoothElement.querySelector('input[placeholder*="A-01"]');
                    if (boothNumberInput) {
                        setTimeout(() => {
                            boothNumberInput.focus();
                        }, 500);
                    }
                }
            }, 100);
        }

        // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì²˜ë¦¬
        function handleAutocompleteKeydown(event, input) {
            if (!currentAutocomplete) return;

            const suggestions = currentAutocomplete.querySelectorAll('.suggestion-item');
            
            switch (event.key) {
                case 'ArrowDown':
                    event.preventDefault();
                    selectedSuggestionIndex = Math.min(selectedSuggestionIndex + 1, suggestions.length - 1);
                    updateSuggestionHighlight(suggestions);
                    break;
                    
                case 'ArrowUp':
                    event.preventDefault();
                    selectedSuggestionIndex = Math.max(selectedSuggestionIndex - 1, -1);
                    updateSuggestionHighlight(suggestions);
                    break;
                    
                case 'Enter':
                    event.preventDefault();
                    if (selectedSuggestionIndex >= 0) {
                        suggestions[selectedSuggestionIndex].click();
                    } else {
                        // ì§ì ‘ ì…ë ¥ëœ ê°’ìœ¼ë¡œ ì¥ë¥´ ì¶”ê°€
                        const boothIndex = parseInt(input.dataset.boothIndex);
                        addGenreFromInput(input, boothIndex);
                    }
                    break;
                    
                case 'Escape':
                    closeAutocomplete();
                    break;
            }
        }

        // ì œì•ˆ í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
        function updateSuggestionHighlight(suggestions) {
            suggestions.forEach((item, index) => {
                item.classList.toggle('highlighted', index === selectedSuggestionIndex);
            });
        }

        // íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFile() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // ê¸°ì¡´ êµ¬ì¡°ì™€ ìƒˆ êµ¬ì¡° ëª¨ë‘ ì§€ì›
                    if (data.eventName && data.booths) {
                        eventData = data;
                    } else if (Array.isArray(data)) {
                        eventData = {
                            eventName: "ìƒˆ í–‰ì‚¬",
                            booths: data
                        };
                    } else {
                        throw new Error("ì˜¬ë°”ë¥´ì§€ ì•Šì€ JSON í˜•ì‹ì…ë‹ˆë‹¤.");
                    }
                    
                    loadEventData();
                    lastSavedData = JSON.stringify(eventData);
                    hasUnsavedChanges = false;
                    alert('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (error) {
                    alert('íŒŒì¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
        });

        // ì´ë²¤íŠ¸ ë°ì´í„°ë¥¼ UIì— ë¡œë“œ
        function loadEventData() {
            document.getElementById('eventName').value = eventData.eventName || "";
            
            const boothList = document.getElementById('boothList');
            boothList.innerHTML = '';
            
            eventData.booths.forEach((booth, index) => {
                createBoothElement(booth, index);
            });
            
            updatePreview();
        }

        // ë¶€ìŠ¤ ìš”ì†Œ ìƒì„±
        function createBoothElement(booth, index) {
            const boothDiv = document.createElement('div');
            boothDiv.className = 'booth-item';
            boothDiv.innerHTML = `
                <button class="remove-booth-btn" onclick="removeBooth(${index})">&times;</button>
                <h4>ë¶€ìŠ¤ #${index + 1}</h4>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ë¶€ìŠ¤ ë²ˆí˜¸</label>
                        <input type="text" class="form-control" value="${booth.boothNumber || ''}" 
                               onchange="updateBooth(${index}, 'boothNumber', this.value)"
                               placeholder="ì˜ˆ: A-01, B-15">
                    </div>
                    <div class="form-group">
                        <label>ë¶€ìŠ¤ëª… (ì„ íƒì‚¬í•­)</label>
                        <input type="text" class="form-control" value="${booth.boothName || ''}" 
                               onchange="updateBooth(${index}, 'boothName', this.value)">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>í™ë³´ URL</label>
                        <input type="url" class="form-control" value="${booth.promoUrl || ''}" 
                               onchange="updateBooth(${index}, 'promoUrl', this.value)">
                    </div>
                    <div class="form-group">
                        <label>ì£¼ë¬¸ URL (ì„ íƒì‚¬í•­)</label>
                        <input type="url" class="form-control" value="${booth.orderUrl || ''}" 
                               onchange="updateBooth(${index}, 'orderUrl', this.value)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ì´ë¯¸ì§€ URL</label>
                    <input type="url" class="form-control" placeholder="ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆ„ë¥´ì„¸ìš”" 
                           onkeypress="addImage(event, ${index})">
                    <div class="image-list" id="imageList${index}">
                        ${(booth.images || []).map((img, imgIndex) => `
                            <div class="image-item">
                                ${img}
                                <button class="remove-image-btn" onclick="removeImage(${index}, ${imgIndex})">&times;</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ì¥ë¥´</label>
                    <div class="autocomplete-container">
                        <input type="text" class="form-control" placeholder="ì¥ë¥´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ìë™ì™„ì„± ì§€ì›)" 
                               data-booth-index="${index}"
                               oninput="handleGenreInput(event, ${index})"
                               onkeydown="handleGenreKeydown(event, ${index})"
                               onkeypress="handleGenreKeypress(event, ${index})">
                    </div>
                    <div class="genre-list" id="genreList${index}">
                        ${(booth.genres || []).map((genre, genreIndex) => `
                            <div class="genre-item">
                                ${genre}
                                <button class="remove-genre-btn" onclick="removeGenre(${index}, ${genreIndex})">&times;</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('boothList').appendChild(boothDiv);
        }

        // ì¥ë¥´ ì…ë ¥ ì²˜ë¦¬
        function handleGenreInput(event, boothIndex) {
            const input = event.target;
            const suggestions = filterGenres(input.value);
            
            if (suggestions.length > 0 && input.value.trim().length > 0) {
                showAutocomplete(input, suggestions);
            } else {
                closeAutocomplete();
            }
        }

        // ì¥ë¥´ í‚¤ë‹¤ìš´ ì²˜ë¦¬
        function handleGenreKeydown(event, boothIndex) {
            handleAutocompleteKeydown(event, event.target);
        }

        // ì¥ë¥´ í‚¤í”„ë ˆìŠ¤ ì²˜ë¦¬ (Enter)
        function handleGenreKeypress(event, boothIndex) {
            if (event.key === 'Enter' && !currentAutocomplete) {
                addGenreFromInput(event.target, boothIndex);
            }
        }

        // ì…ë ¥ì—ì„œ ì¥ë¥´ ì¶”ê°€
        function addGenreFromInput(input, boothIndex) {
            const genre = input.value.trim();
            if (genre) {
                if (!eventData.booths[boothIndex].genres) {
                    eventData.booths[boothIndex].genres = [];
                }
                
                // ì¤‘ë³µ ì²´í¬
                if (!eventData.booths[boothIndex].genres.includes(genre)) {
                    eventData.booths[boothIndex].genres.push(genre);
                    input.value = '';
                    updateGenreList(boothIndex);
                    updatePreview();
                    saveToLocalStorage(); // ìë™ ì €ì¥
                    checkForChanges(); // ë³€ê²½ì‚¬í•­ ì²´í¬
                } else {
                    alert('ì´ë¯¸ ì¶”ê°€ëœ ì¥ë¥´ì…ë‹ˆë‹¤.');
                }
            }
            closeAutocomplete();
        }

        // ìƒˆ ë¶€ìŠ¤ ì¶”ê°€
        function addBooth() {
            const newBooth = {
                boothNumber: "",
                boothName: "",
                promoUrl: "",
                orderUrl: "",
                images: [],
                genres: []
            };
            
            eventData.booths.push(newBooth);
            createBoothElement(newBooth, eventData.booths.length - 1);
            updatePreview();
            saveToLocalStorage(); // ìë™ ì €ì¥
            checkForChanges(); // ë³€ê²½ì‚¬í•­ ì²´í¬
        }

        // ë¶€ìŠ¤ ì œê±°
        function removeBooth(index) {
            if (confirm('ì´ ë¶€ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                eventData.booths.splice(index, 1);
                loadEventData();
                saveToLocalStorage(); // ìë™ ì €ì¥
                checkForChanges(); // ë³€ê²½ì‚¬í•­ ì²´í¬
            }
        }

        // ë¶€ìŠ¤ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateBooth(index, field, value) {
            eventData.booths[index][field] = value;
            updatePreview();
            saveToLocalStorage(); // ìë™ ì €ì¥
            checkForChanges(); // ë³€ê²½ì‚¬í•­ ì²´í¬
        }

        // ì´ë¯¸ì§€ ì¶”ê°€
        function addImage(event, boothIndex) {
            if (event.key === 'Enter') {
                const url = event.target.value.trim();
                if (url) {
                    if (!eventData.booths[boothIndex].images) {
                        eventData.booths[boothIndex].images = [];
                    }
                    eventData.booths[boothIndex].images.push(url);
                    event.target.value = '';
                    updateImageList(boothIndex);
                    updatePreview();
                    saveToLocalStorage(); // ìë™ ì €ì¥
                    checkForChanges(); // ë³€ê²½ì‚¬í•­ ì²´í¬
                }
            }
        }

        // ì´ë¯¸ì§€ ì œê±°
        function removeImage(boothIndex, imageIndex) {
            eventData.booths[boothIndex].images.splice(imageIndex, 1);
            updateImageList(boothIndex);
            updatePreview();
            saveToLocalStorage(); // ìë™ ì €ì¥
            checkForChanges(); // ë³€ê²½ì‚¬í•­ ì²´í¬
        }

        // ì´ë¯¸ì§€ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateImageList(boothIndex) {
            const imageList = document.getElementById(`imageList${boothIndex}`);
            const images = eventData.booths[boothIndex].images || [];
            
            imageList.innerHTML = images.map((img, imgIndex) => `
                <div class="image-item">
                    ${img}
                    <button class="remove-image-btn" onclick="removeImage(${boothIndex}, ${imgIndex})">&times;</button>
                </div>
            `).join('');
        }

        // ì¥ë¥´ ì œê±°
        function removeGenre(boothIndex, genreIndex) {
            eventData.booths[boothIndex].genres.splice(genreIndex, 1);
            updateGenreList(boothIndex);
            updatePreview();
            saveToLocalStorage(); // ìë™ ì €ì¥
            checkForChanges(); // ë³€ê²½ì‚¬í•­ ì²´í¬
        }

        // ì¥ë¥´ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateGenreList(boothIndex) {
            const genreList = document.getElementById(`genreList${boothIndex}`);
            const genres = eventData.booths[boothIndex].genres || [];
            
            genreList.innerHTML = genres.map((genre, genreIndex) => `
                <div class="genre-item">
                    ${genre}
                    <button class="remove-genre-btn" onclick="removeGenre(${boothIndex}, ${genreIndex})">&times;</button>
                </div>
            `).join('');
        }

        // JSON ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePreview() {
            const preview = document.getElementById('jsonPreview');
            preview.textContent = JSON.stringify(eventData, null, 2);
        }

        // JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        function downloadJSON() {
            const dataStr = JSON.stringify(eventData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `${eventData.eventName || 'event'}.json`;
            link.click();
            
            // ì €ì¥ ì™„ë£Œ í›„ ë³€ê²½ì‚¬í•­ í”Œë˜ê·¸ ë¦¬ì…‹
            lastSavedData = JSON.stringify(eventData);
            hasUnsavedChanges = false;
            showSaveNotification('JSON íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
    </script>
</body>
</html>
